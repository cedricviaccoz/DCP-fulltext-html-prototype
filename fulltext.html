<div id="no-content"> This document currently holds no OCR text to be downloaded. 
</div>

<div id="progress">
  <div id="bar"></div>
  <div id="loading-text">Retrieving item metadata, please wait...</div>
</div>

<div id="fulltext-zone">

</div>

<script type="text/javascript">
	const drs_id = 2585728;
	const hasocr = true;

	//const drs_id = <%document[:drs_id]%>

	if(hasocr){
		// async and await and sleep are all used to simulate an API request taking time to get resolved.
		async function update(){
			document.getElementById('no-content').style.display = "none";
			let pageNumber = retrieveNumberOfPages(drs_id);
			for(let i = 0; i<=pageNumber; ++i){
				//sleeping to simulate API call taking time to get resolved.
				await sleep(100);
				let pageOCR = (String(drs_id)+" : "+String(i)+"; <br></br>");
				updateBar(i, pageNumber);
				updateTextZone(pageOCR);
			}
			document.getElementById('progress').style.display = "none";	
		}
		update();
	}else{
		document.getElementById('no-content').style.display = "block";
		document.getElementById('progress').style.display = "none";
	}

	function updateTextZone(textToAppend){
		let textZone = document.getElementById('fulltext-zone');
		textZone.innerHTML += textToAppend;
	}


	function retrieveNumberOfPages(drs_id){
		return 120;
	}


	function updateBar(currentPage, totalPage) {
	  let bar = document.getElementById("bar"); 
	  let width = (currentPage/totalPage) * 100;
      bar.style.width = width + '%'; 
      let loadText = document.getElementById("loading-text"); 
      loadText.innerText = "Loading full text ("+ String(currentPage)+" of "+String(totalPage)+" pages)"
	}


	//TODO: remove
	function sleep(ms) {
	  return new Promise(resolve => setTimeout(resolve, ms));
	}


</script>

<style type="text/css">
#progress {
	width: 100%;
	height: 40px;
	background-color: white;
	position: relative;
	border: solid;
}

#bar {
	width: 1%;
	height: 40px;
	background-color: silver;
}

#loading-text {
	position: absolute;
	top: 10px;
	height: 20px;
	font-family: "Trueno", Helvetica, Roboto, Arial, sans-serif;
	text-align: center;
	width: 100%;
	z-index: 10;
}

</style>